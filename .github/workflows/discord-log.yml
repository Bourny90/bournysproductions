name: Log Website Update to Discord

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
  uses: actions/checkout@v3

      - name: Generate version
        run: echo "VERSION=1.0.$(git rev-list --count HEAD)" >> $GITHUB_ENV

      - name: Send fancy embed to Discord
        run: |
          TIME=$(date -u +"%Y-%m-%d %H:%M:%S UTC")

          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"embeds\": [{
              \"title\": \"ðŸš€ Website Updated\",
              \"color\": 15158332,
              \"fields\": [
                {\"name\": \"Version\", \"value\": \"v${{ env.VERSION }}\", \"inline\": true},
                {\"name\": \"Pushed By\", \"value\": \"${{ github.actor }}\", \"inline\": true},
                {\"name\": \"Commit Message\", \"value\": \"${{ github.event.head_commit.message }}\", \"inline\": false},
                {\"name\": \"Published At\", \"value\": \"$TIME\", \"inline\": false}
              ],
              \"footer\": {
                \"text\": \"Auto deployment logger\"
              }
            }]
          }" \
          ${{ secrets.DISCORD_WEBHOOK }}
